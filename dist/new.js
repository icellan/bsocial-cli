import bsv from"bsv";import{BAP}from"bitcoin-bap";import{BAP_PROTOCOL_ADDRESS}from"bsocial/dist/constants.js";import{askProfileInfo,askProfileName}from"./inquirer.js";import{broadcastTransaction}from"./bitcoin.js";export const newProfile=async function(a){const b=Object.keys(a.all),c=await askProfileName(b.length),d=await askProfileInfo(),e=bsv.HDPrivateKey.fromRandom().toString(),f=new BAP(e),g=f.newId();g.name=c.name.replace(/[^a-z0-9_-]/ig,"_"),Object.keys(d).forEach(a=>{d[a]&&g.setAttribute(a,d[a])});const h=f.exportIds(),i={xpriv:e,ids:h},j=g.getIdTransaction(),k=g.signOpReturnWithAIP(j),l=await broadcastTransaction(i,k);if(!l)return;const m={"@context":"https://schema.org","@type":"Person",alternateName:d.name||"",logo:d.logo||"",banner:d.banner||"",homeLocation:{"@type":"Place",name:d.location||""},description:d.description||"",url:d.url||"",paymail:d.paymail||"",bitcoinAddress:d.bitcoinAddress||""},n=[];n.push(Buffer.from(BAP_PROTOCOL_ADDRESS).toString("hex")),n.push(Buffer.from("ALIAS").toString("hex")),n.push(Buffer.from(g.getIdentityKey()).toString("hex")),n.push(Buffer.from(JSON.stringify(m)).toString("hex"));const o=g.signOpReturnWithAIP(n),p=await broadcastTransaction(i,o);if(p)return a.set(g.name,i),g.name};