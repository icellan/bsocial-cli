import bsv from"bsv";import{BAP}from"bitcoin-bap";import{getSignedAliasOps}from"./profile.js";import{askProfileInfo,askProfileName,askWaitFunding}from"./inquirer.js";import{broadcastTransaction,getBalance}from"./bitcoin.js";import{loadSats}from"./sats.js";export const newProfile=async function(a){const b=Object.keys(a.all),c=await askProfileName(b.length),d=await askProfileInfo(),e=bsv.HDPrivateKey.fromRandom().toString(),f=new BAP(e),g=f.newId();g.name=c.name.replace(/[^a-z0-9_-]/ig,"_"),Object.keys(d).forEach(a=>{d[a]&&g.setAttribute(a,d[a])});const h=f.exportIds(),i={xpriv:e,ids:h};for(console.log("Please fund this address to be able to create the on-chain profile.\n"),loadSats(i);;){let a=await getBalance(i);if(500<a)break;const b=await askWaitFunding();if("cancel"===b.selected)return}const j=g.getIdTransaction(),k=g.signOpReturnWithAIP(j),l=await broadcastTransaction(i,k);if(!l)return;a.set(g.name,i);const m=getSignedAliasOps(d,g),n=await broadcastTransaction(i,m);return n?g.name:void 0};