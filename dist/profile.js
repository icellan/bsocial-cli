import{BAP}from"bitcoin-bap";import{broadcastTransaction,getBalance}from"./bitcoin.js";import{BAP_PROTOCOL_ADDRESS}from"bsocial/dist/constants.js";import{askAreYouSure,askProfileInfo}from"./inquirer.js";export const editProfile=async function(a){const b=new BAP(a.xpriv);b.importIds(a.ids);const c=b.listIds(),d=b.getId(c[0]),e={},f=d.getAttributes();Object.keys(f).forEach(a=>{const b=f[a];e[a]=b.value});const g=await askProfileInfo(e),h=getSignedAliasOps(g,d),i=await broadcastTransaction(a,h);return!!i||void 0};export const deleteProfile=async function(a,b,c){const d=await askAreYouSure("Are you sure you want to delete this profile?");if("yes"===d.sure){const d=await getBalance(b);return 0<d?(console.error("Address of this identity still has a positive balance of",d,"satoshis."),console.log("Please transfer this balance before deleting the profile."),!1):(c.delete(a),!0)}};export const getSignedAliasOps=function(a,b){const c={"@context":"https://schema.org","@type":"Person",alternateName:a.name||"",logo:a.logo||"",banner:a.banner||"",homeLocation:{"@type":"Place",name:a.location||""},description:a.description||"",url:a.url||"",paymail:a.paymail||"",bitcoinAddress:a.bitcoinAddress||""},d=[];return d.push(Buffer.from(BAP_PROTOCOL_ADDRESS).toString("hex")),d.push(Buffer.from("ALIAS").toString("hex")),d.push(Buffer.from(b.getIdentityKey()).toString("hex")),d.push(Buffer.from(JSON.stringify(c)).toString("hex")),b.signOpReturnWithAIP(d)};